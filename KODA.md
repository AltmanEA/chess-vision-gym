# KODA — Инструкционный контекст проекта

## Обзор проекта

**Название проекта**: Chess Vision Gym (Шахматный тренажер)

**Назначение**: Веб-приложение для тренировки шахматного зрения и решения шахматных задач. Пользователи могут решать различные типы задач (нахождение нужного поля, хода, последовательности ходов), а приложение отслеживает статистику решений и сохраняет все попытки пользователя.

**Текущий статус**: Проект находится на ранней стадии разработки. Базовая инфраструктура настроена, реализовано отображение шахматной доски с возможностью загрузки позиций из FEN. Функционал решения задач и статистика еще не реализованы.

---

## Технологический стек

### Frontend
- **Фреймворк**: React 19 с использованием Vite
- **Язык**: TypeScript (строгий режим включен)
- **Сборщик**: Vite
- **Стили**: CSS (без препроцессоров)

### Основные библиотеки
- **chess.js**: Библиотека для работы с шахматной логикой (валидация ходов, FEN, PGN)
- **react-chessboard**: Компонент для отображения шахматной доски

### Хранение данных
- **localStorage**: Основное хранилище для статистики и попыток пользователя
- **Расширяемость**: Архитектура позволяет добавить серверное хранение в будущем

---

## Архитектура

### Трехуровневая архитектура

```
┌─────────────────────────────────────┐
│   Presentation Layer (UI)           │
│   - React компоненты                 │
│   - Хуки состояния                   │
│   - Контекст                         │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   Business Logic Layer              │
│   - Custom Hooks                     │
│   - Сервисы бизнес-логики           │
│   - Хуки контекста                  │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   Data Access Layer                 │
│   - Сервисы работы с данными        │
│   - API (будет добавлен)            │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   Хранилища данных                  │
│   - localStorage                    │
│   - Внешние файлы задач (JSON)      │
└─────────────────────────────────────┘
```

### Структура проекта

```
chess-vision-gym/
├── src/
│   ├── components/          # React компоненты (пока пусто)
│   ├── utils/
│   │   └── fenUtils.ts      # Утилиты для работы с FEN
│   ├── App.tsx              # Главный компонент приложения
│   ├── App.css              # Стили главного компонента
│   ├── main.tsx             # Точка входа в приложение
│   ├── index.css            # Глобальные стили
│   └── assets/              # Статические ресурсы
├── public/                  # Публичные файлы
├── doc/                     # Документация проекта
│   ├── overview.md          # Обзор проекта
│   ├── plan.md              # План реализации
│   └── spec.md              # Спецификация приложения
├── package.json             # Зависимости и скрипты
├── vite.config.ts           # Конфигурация Vite
├── tsconfig.json            # Конфигурация TypeScript
├── tsconfig.app.json        # TypeScript для приложения
├── tsconfig.node.json       # TypeScript для Node.js
└── eslint.config.js         # Конфигурация ESLint
```

---

## Сборка и запуск

### Основные команды

```bash
# Установка зависимостей (при первом запуске)
npm install

# Запуск dev-сервера (http://localhost:5173)
npm run dev

# Сборка для продакшена
npm run build

# Предпросмотр продакшн-сборки
npm run preview

# Проверка кода линтером
npm run lint

# Запуск TypeScript компилятора
npx tsc --noEmit
```

### Зависимости

**Production:**
- `react`: ^19.0.0
- `react-dom`: ^19.0.0
- `chess.js`: ^1.0.0-beta.8
- `react-chessboard`: ^4.8.0

**Development:**
- `@vitejs/plugin-react`: ^4.3.4
- `typescript`: ~5.7.2
- `vite`: ^6.0.7
- `eslint`: ^9.18.0
- `typescript-eslint`: ^8.19.1
- `eslint-plugin-react-hooks`: ^5.1.0
- `eslint-plugin-react-refresh`: ^0.4.16

---

## Правила разработки

### Конвенции кода

1. **TypeScript**:
   - Используется строгий режим (`strict: true`)
   - Все переменные должны иметь явные типы
   - Запрещены неиспользуемые локальные переменные и параметры
   - Используются JSDoc комментарии для функций

2. **React**:
   - Используются функциональные компоненты
   - Хуки для управления состоянием и побочными эффектами
   - JSX: `react-jsx` (новый трансформатор)
   - Компоненты именуются в PascalCase

3. **Стиль кода**:
   - ESLint конфигурация включает рекомендации для JavaScript, TypeScript и React Hooks
   - Используются плагины `react-hooks` и `react-refresh` для Vite
   - Форматирование следует стандарту ESLint

4. **Файловая структура**:
   - Компоненты размещаются в `src/components/`
   - Утилиты и бизнес-логика в `src/utils/`
   - Каждый файл содержит одну сущность (компонент, утилиту, сервис)

### Тестирование

**Текущее состояние**: Тесты не настроены.

**TODO**: Добавить тестовый фреймворк (рекомендуется Vitest для Vite + React Testing Library) и настроить тестирование:
- Unit-тесты для утилит (`fenUtils.ts`)
- Компонентные тесты для React-компонентов
- Интеграционные тесты для проверки функционала

### Контрибьюшн

При добавлении нового кода:
1. Следуйте существующей архитектуре (трехуровневая)
2. Добавляйте JSDoc комментарии к публичным функциям
3. Проверяйте код с помощью `npm run lint`
4. Убедитесь, что TypeScript компилируется без ошибок (`npx tsc --noEmit`)
5. Следуйте плану реализации в `doc/plan.md`

---

## Функциональные возможности

### Реализовано

1. **Отображение шахматной доски**:
   - Использование `react-chessboard`
   - Загрузка позиции из FEN строки
   - Интерактивная доска с перетаскиванием фигур
   - Валидация FEN через `chess.js`

2. **Утилиты для работы с FEN**:
   - `validateFen()`: проверка корректности FEN строки
   - `loadPositionFromFen()`: загрузка позиции из FEN
   - `setInitialPosition()`: установка начальной позиции

### В процессе разработки

Согласно плану в `doc/plan.md`:

- **Определение структуры данных задач** (в работе)
- **Формат хранения статистики** (не начато)
- **Реализация функционала решения задач** (не начато)
- **Реализация хранения статистики** (не начато)
- **Разработка пользовательского интерфейса** (не начато)

### Запланировано

1. **Типы задач**:
   - Нахождение нужного поля
   - Нахождение нужного хода
   - Последовательность ходов

2. **Статистика**:
   - Время решения
   - Количество попыток
   - Процент правильных ответов
   - Среднее время решения

3. **Пользовательский интерфейс**:
   - Основной экран задач
   - Экран статистики
   - Панель управления (следующая, предыдущая, сброс задачи)
   - Адаптивный дизайн

---

## Ключевые файлы и их назначение

| Файл | Назначение |
|------|------------|
| `package.json` | Зависимости проекта и npm-скрипты |
| `vite.config.ts` | Конфигурация сборщика Vite |
| `tsconfig.json` | Базовая конфигурация TypeScript |
| `tsconfig.app.json` | Конфигурация TypeScript для приложения |
| `eslint.config.js` | Конфигурация линтера |
| `src/main.tsx` | Точка входа в приложение |
| `src/App.tsx` | Главный компонент с шахматной доской |
| `src/utils/fenUtils.ts` | Утилиты для работы с FEN |
| `src/index.css` | Глобальные стили приложения |
| `src/App.css` | Стили главного компонента |
| `doc/overview.md` | Обзор проекта |
| `doc/plan.md` | План реализации с статусами |
| `doc/spec.md` | Полная спецификация приложения |

---

## Документация

### Основные документы

- **`doc/overview.md`**: Краткий обзор проекта, назначение и технологии
- **`doc/plan.md`**: План реализации с 7 этапами и статусами выполнения
- **`doc/spec.md`**: Полная спецификация, включая архитектуру, функциональные требования, требования к UI

### Спецификация ключевых аспектов

- **Архитектура**: Трехуровневая (Presentation → Business Logic → Data Access)
- **Формат задач**: JSON (будет определен позднее)
- **Хранение данных**: localStorage с возможностью расширения
- **Безопасность**: Без аутентификации, данные хранятся локально
- **Производительность**: Быстрая загрузка, мгновенный отклик UI

---

## Примечания для разработчика

### Текущие ограничения

1. Нет тестов — нужно добавить Vitest и React Testing Library
2. Нет типизированного формата задач — нужно определить JSON-схему
3. Нет сервиса статистики — нужно реализовать сохранение/загрузку из localStorage
4. Нет компонента задач — нужно создать UI для решения задач
5. Нет экрана статистики — нужно создать UI для отображения результатов

### Рекомендуемые следующие шаги

1. Определить структуру данных задач (JSON-формат)
2. Реализовать сервис для работы с localStorage
3. Создать компонент задачи с логикой проверки ответов
4. Реализовать экран статистики
5. Добавить тесты

### Важные детали реализации

- Используйте `chess.js` для валидации ходов и работы с FEN
- Используйте `react-chessboard` для отображения доски
- Следуйте трехуровневой архитектуре при создании новых модулей
- Добавляйте JSDoc комментарии к функциям
- Проверяйте код линтером и TypeScript перед коммитом

---

## Контакт и поддержка

Проект находится в активной разработке. Вопросы и предложения по улучшению архитектуры следует направлять в документацию (`doc/`) или обсуждать в рамках команды разработки.
